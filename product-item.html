<!DOCTYPE html>
<html style="height: 100%">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Products</title>
    <!-- Fonts -->
    <link
      href="https://fonts.bunny.net/css2?family=Nunito:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD"
      crossorigin="anonymous"
    />
    <!-- <link rel="stylesheet" href="https://kit.fontawesome.com/0f35bb7307.css" crossorigin="anonymous"> -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>


    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>


    <style>
      body {
        font: "Inter";
      }
      .content {
        display: flex;
        min-width: 97vw;
        max-width: 98vw;
      }
      /* start of navbar and top bar */
      .left-nav {
        height: 100vh;
        background-color: #c6f4d3;
        width: 200px;
        border-radius: 0px 5px 5px 0px;
        margin-right: 10px;
        position: fixed;
        padding-top: 30px;
      }
      .left-nav h1 {
        font-size: 33px;
        color: white;
        padding: 15px;
      }
      .left-nav a {
        color: black;
        text-decoration: none;

        align-items: center;
      }
      .left-nav p {
        font-size: 15px;
        font-weight: 500;
        padding-left: 15px;
        margin-bottom: 0;
      }
      .menu-options {
        display: flex;
        padding-left: 15px;
        padding-bottom: 10px;
        padding-top: 10px;
        align-items: center;
      }
      .menu-options :active {
        color: #fcca38;
      }
      #logout {
        position: absolute;
        bottom: 0;
      }
      .icons {
        width: 20px;
        height: 20px;
      }
      .right-side {
        margin-left: 215px;
        margin-bottom: 20px;
        width: 100vw;
      }
      input {
        width: 600px;
        height: 40px;
        background-color: #edf6f0;
        border-radius: 13px;
        border: 0px;
      }
      .search-bar {
        margin-left: 10px;
        margin-right: 10px;
        margin-top: 15px;
      }

      .user {
        display: flex;
        margin-right: 15px;
        margin-top: 15px;
        align-items: center;
        justify-content: center;
        margin-left: auto;
      }
      .user p {
        margin-bottom: 0;
        padding-left: 10px;
        font-weight: 500;
      }
      .user img {
        width: 30px;
        height: 30px;
        margin-top: 5px;
      }
      .right-top {
        display: flex;
        align-items: center;
      }
      .left-nav a:hover {
        background-color: #a5e2b7;
      }
      /* End of navbar and top bar */

      /* item list */
      .item-header {
        display: flex;
        justify-content: space-around;
      }
      .item-header h3 {
        font-size: 20px;
      }
      .sort-header {
        display: flex;
        align-items: center;
      }
      #sales-header {
        font-size: 27px;
        margin-left: 15px;
        margin-bottom: 20px;
      }
      .right-bottom {
        padding-top: 10px;
      }
      .item-list {
        display: inline-block;
        justify-content: space-evenly;
        width: 100%;
      }

      /* end of item list */

      .overview {
        display: flex;
      }
      .info input {
        width: 400px;
      }
      .info {
        padding: 10px;
      }
      .info label {
        padding-right: 50px;
        width: 100px;
      }

      #changebtn {
        background-color: #e6e3e3;
        border: 0px;
        border-radius: 15px;
        padding: 1px 30px 1px 30px;
      }

      .bottom-left {
        padding-right: 100px;
      }

      #sort-options {
        border: 0px;
        border-radius: 13px;
        background-color: #edf6f0;
        width: 400px;
        height: 40px;
      }

      .buttons {
        display: flex;
        justify-content: center;
        gap: 10px;
      }
      #cancelbtn {
        border-radius: 10px;
        border: 0px;
        padding: 7px 20px 7px 20px;
      }
      #savebtn {
        border-radius: 10px;
        border: 0px;
        background-color: #b3efbd;
        padding: 7px 20px 7px 20px;
      }
      #reservebtn{
        border-radius: 10px;
        border: 0px;
        background-color: #b3efbd;
        padding: 7px 20px 7px 20px;
      }
    </style>
  </head>
  <body class="content">
    <div class="left-nav">
      <a class="menu-options" href="admin-home.html">
        <img src="/images/home 1.png" class="icons" />
        <p>Home</p>
      </a>
      <a class="menu-options" href="admin-products.html">
        <img src="/images/producticon.png" class="icons" />
        <p>Products</p>
      </a>
      <a class="menu-options" href="admin-dashboard.html">
        <img src="/images/bar-chart.png" class="icons" />
        <p>Dashboard</p>
      </a>
      <a class="menu-options" href="admin-order.html">
        <img src="/images/checklists.png" class="icons" />
        <p>Order Management</p>
      </a>
      <a class="menu-options">
        <img src="/images/settings 1.png" class="icons" />
        <p>Settings</p>
      </a>
      <a class="menu-options" id="logout">
        <img src="/images/logout 2.png" class="icons" />
        <p>Log Out</p>
      </a>
    </div>

    <div class="right-side">
      <div class="right-top">
        <div class="search-bar">
          <input type="text" placeholder="Search for stock" />
        </div>
        <div class="user">
          <img src="/images/user 2.png" class="icons" />
          <p>User name</p>
        </div>
      </div>

      <div class="right-bottom">
        <div class="sort-header">
          <h3 id="sales-header">Product Overview</h3>
        </div>
        <div class="overview">
          <div class="bottom-left">
            <div>
              <h1>image</h1>
            </div>
            <div>
              <button id="changebtn">Change Image</button>
            </div>
          </div>
          <div class="bottom-right">
            <div class="info">
              <label>product id</label>
              <input type="text" id="product-input" />
            </div>
            <div class="info">
              <label>Name</label>
              <input type="text" id="name-input" />
            </div>
            <div class="info">
              <label>Stock</label>
              <input type="text" id="stock-input" />
            </div>
            <div class="info">
              <label>Price</label>
              <input type="text" id="price-input" />
            </div>
            <div class="info" style="display: flex">
              <label>Category</label>
              <div id="category-select">
                <select id="category-options" name="category">
                  <option value="category">Category</option>
                </select>
              </div>
            </div>
            <div class="info" style="display: flex">
              <label>Sub Category</label>
              <div id="subcategory-select">
                <select id="subcategory-options" name="subcategory">
                  <option value="subcategory">Sub Category</option>
                </select>
              </div>
            </div>
          </div>
        </div>
        <div class="buttons">
          <div style="padding-right: 20px">
            <button id="cancelbtn">Cancel</button>
          </div>
          <div>
            <button id="savebtn">Save Changes</button>
            <button id="reservebtn" data-bs-toggle="modal" data-bs-target="#reserveModal">Reserve Inventory</button>
          </div>
        </div>

        <!-- Reserve Inventory Modal -->
      <div class="modal fade" id="reserveModal" tabindex="-1" aria-labelledby="reserveModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="reserveModalLabel">Reserve Inventory</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="mb-3">
          <p id="stock-display"></p>
          <label for="reserve-input" class="form-label">Quantity to reserve:</label>
          <input type="number" class="form-control" id="reserve-input">
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary" id="reserve-confirm">Reserve</button>
      </div>
    </div>
  </div>
</div>
      </div>

      <script>
        // Get the query parameters from the URL
        const queryParams = new URLSearchParams(window.location.search);

        // Get the values from the query parameters
        const name = decodeURIComponent(queryParams.get("name"));
        const stock = decodeURIComponent(queryParams.get("stock"));
        const price = decodeURIComponent(queryParams.get("price"));
        const category = decodeURIComponent(queryParams.get("category"));
        const subcategory = decodeURIComponent(queryParams.get("subcategory"));
        const productID = decodeURIComponent(queryParams.get("productID"));

        // Set the values in the input fields
        document.getElementById("name-input").value = name;
        document.getElementById("stock-input").value = stock;
        document.getElementById("price-input").value = price;
        document.getElementById("product-input").value = productID;

        // Set the selected category and subcategory options
        document.getElementById("category-options").value = category;
        document.getElementById("subcategory-options").value = subcategory;
        // Cancel button
        document
          .getElementById("cancelbtn")
          .addEventListener("click", function () {
            history.back();
          });

        // Handle "Save Changes" button click event
        document
          .getElementById("savebtn")
          .addEventListener("click", function (event) {
            event.preventDefault(); // Prevent default form submission

            // Perform the necessary actions to save the changes
            // Get the updated values from the input fields
            const updatedName = document.getElementById("name-input").value;
            const updatedStock = document.getElementById("stock-input").value;
            const updatedPrice = document.getElementById("price-input").value;

            // Get the selected category and subcategory values
            const updatedCategory =
              document.getElementById("category-options").value;
            const updatedSubcategory = document.getElementById(
              "subcategory-options"
            ).value;

            // Create an object with the updated data
            const updatedProductData = {
              name: updatedName,
              stock: updatedStock,
              price: updatedPrice,
              category: updatedCategory,
              subcategory: updatedSubcategory,
            };

            // Show a confirmation popup with the changes
            const confirmationMessage = `Are you sure you want to save the changes?`;
            const confirmed = confirm(confirmationMessage);

            if (confirmed) {
              // Send an AJAX request to update the product data
              $.ajax({
                url: "http://localhost:8000/updateItem/" + productID, // Add the product ID to the URL
                method: "PUT",
                data: JSON.stringify(updatedProductData),
                contentType: "application/json",
                success: function (response) {
                  console.log("Product data updated successfully");
                  // Handle success response
                },
                error: function (xhr, status, error) {
                  console.error("Error updating product data:", error);
                  // Handle error response
                },
              });
            }
          });
          
      //** FOR RESERVE INVENTORY BUTTON **//
      // Get the reserve input and reserve button

      const reserveInput = document.getElementById("reserve-input");
      const reserveButton = document.getElementById("reserve-confirm");
      
      // Handle "Reserve Inventory" button click event
      reserveButton.addEventListener("click", function () {
      const quantityToReserve = reserveInput.value;
      
      /*
      const reservedInventoryQuantity = {
        quantity: quantityToReserve
      };
      */
      const updatedName = document.getElementById("name-input").value;
            const updatedStock = document.getElementById("stock-input").value;
            const updatedPrice = document.getElementById("price-input").value;

            // Get the selected category and subcategory values
            const updatedCategory =
              document.getElementById("category-options").value;
            const updatedSubcategory = document.getElementById(
              "subcategory-options"
            ).value;

            // Create an object with the updated data
            const updatedProductData = {
              name: updatedName,
              stock: updatedStock,
              price: updatedPrice,
              category: updatedCategory,
              subcategory: updatedSubcategory,
            };

            // Show a confirmation popup with the changes
            const confirmationMessage = `Are you sure you want to save the changes?`;
            const confirmed = confirm(confirmationMessage);

            if (confirmed) {
              // Send an AJAX request to update the product data
              $.ajax({
                url: "http://localhost:8000/reserveInventory/" + productID, // Add the product ID to the URL
                method: "PUT",
                data: JSON.stringify(updatedProductData),
                contentType: "application/json",
                success: function (response) {
                  console.log("Product data updated successfully");
                  // Handle success response
                },
                error: function (xhr, status, error) {
                  console.error("Error updating product data:", error);
                  // Handle error response
                },
              });
            }

    // Close the modal
    const reserveModal = new bootstrap.Modal(document.getElementById("reserveModal"));
    reserveModal.hide();
  });


      </script>



      <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
      <script>
        // Fetch categories and subcategories from the server
        fetchCategoriesAndSubcategories();

        function fetchCategoriesAndSubcategories() {
          $.ajax({
            url: "http://localhost:8000/Products",
            method: "GET",
            dataType: "json",
            success: function (response) {
              const data = response.products; // Assuming the "products" property contains the array of products
              const categorySelect = $("#category-options");
              const subcategorySelect = $("#subcategory-options");
              const categoryInput = $("#category-input");
              const subcategoryInput = $("#subcategory-input");

              // Clear existing options in the category and subcategory dropdowns
              categorySelect.empty();
              subcategorySelect.empty();

              // Collect unique categories and subcategories
              const uniqueCategories = new Set();
              const uniqueSubcategories = new Set();

              data.forEach(function (product) {
                const category = product.Category;
                const subcategory = product["Sub Category"];

                uniqueCategories.add(category);
                uniqueSubcategories.add(subcategory);
              });

              // Populate category dropdown
              uniqueCategories.forEach(function (category) {
                const option = $("<option>")
                  .attr("value", category)
                  .text(category);
                categorySelect.append(option);
              });

              // Populate subcategory dropdown
              uniqueSubcategories.forEach(function (subcategory) {
                if (subcategory !== null) {
                  const option = $("<option>")
                    .attr("value", subcategory)
                    .text(subcategory);
                  subcategorySelect.append(option);
                }
              });

              // Get the category and subcategory values from query parameters
              const queryParams = new URLSearchParams(window.location.search);
              const category = decodeURIComponent(queryParams.get("category"));
              const subcategory = decodeURIComponent(
                queryParams.get("subcategory")
              );

              // Set the selected values in the dropdowns
              categorySelect.val(category);
              subcategorySelect.val(subcategory);
            },
            error: function (xhr, status, error) {
              console.error(
                "Error fetching categories and subcategories:",
                error
              );
            },
          });
        }
      </script>
    </div>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD"
      crossorigin="anonymous"
    />
  </body>
</html>
